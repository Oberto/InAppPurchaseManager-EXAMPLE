<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="InAppPurchaseManager Example : I have had so many issues getting the OG version to work, I had to share this so others can stop struggling and get to work!" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>InAppPurchaseManager Example</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/usmart/InAppPurchaseManager-EXAMPLE">View on GitHub</a>

          <h1 id="project_title">InAppPurchaseManager Example</h1>
          <h2 id="project_tagline">I have had so many issues getting the OG version to work, I had to share this so others can stop struggling and get to work!</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/usmart/InAppPurchaseManager-EXAMPLE/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/usmart/InAppPurchaseManager-EXAMPLE/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>iOS InAppPurchaseManager EXAMPLE OCTOBER 2012</h1>

<p>I have had so many issues getting the <a href="https://github.com/phonegap/phonegap-plugins/tree/master/iOS/InAppPurchaseManager">OG</a> version to work, I had to share this so others can stop struggling and get to work! Here is a modifed working version of this plugin, which also explains how to use the ApplicationPreferences Phonegap plugin to unlock products in your app, and the ever dreaded, "how do I make a restore purchases call" and then unlock contents. I have also included a few project screen shots that will hopefully help first timers out.</p>

<p>Props first go to the main deveoper who has made this possible, <a href="https://github.com/phonegap/phonegap-plugins/tree/master/iOS/InAppPurchaseManager">Matt Kane</a>. And the countless other people on the web posting examples and helping out with questions.</p>

<p>IF ANYONE wants to help clean this up and bring it more up to speed than this, I am all for it!</p>

<h2>Adding the Plugin to your project</h2>

<p>Copy the NEWLY REVISED .h and .m files to the Plugins directory in your project. Copy the NEWLY REVISED .js file to your www directory and reference it from your html file(s). Finally, add StoreKit.framework to your Xcode project if you haven't already. </p>

<h3>Adding StoreKit to you project.</h3>

<ol>
<li> Click on your project</li>
<li> then your project target</li>
<li> then Build Phases</li>
<li> then open the Link Binary with Libraries. </li>
<li> Now drag the storeKit Framework over to your Project name area, as depicted in photo.</li>
</ol><p><img src="http://slickremix.com/gitub-InAppPurchaseManager-EXAMPLE-images/storekit.png" alt="My image"></p>

<h3>ALSO</h3>

<p>If you want to UNLOCK PRODUCTS as I have done below you will need to use the <a href="https://github.com/phonegap/phonegap-plugins/tree/master/iPhone/ApplicationPreferences">ApplicationPreferences Plugin</a>. Everything works out of the box here too. 
You do not really need to worry about the examples displayed there for the example code below, just add the files to your plugin folder as instructed on that page.</p>

<p>I am using cordova 2.0. If you are using 2.1 all instances of JSONString in InAppPurchaseManager.m must be replaced with cdvjk_JSONString</p>

<h2>MOST IMPORTANT</h2>

<p>Dont forget to add the plugins names to your .plist in your project name folder.</p>

<ul>
<li>For example the in-app plugin needs to be...take note the first on has a lower case i, this is not a typo!</li>
<li>inAppPurchaseManager (string name is) InAppPurchaseManager</li>
</ul><p>Then if you are using going to implement the ApplicationPreferences Plugin don't forget to add that to .plist too.</p>

<ul>
<li>This plugins names both start with a lower case a.</li>
<li>applicationPreferences (string name is) applicationPreferences</li>
</ul><h2>Using the plugin</h2>

<p>You can read the details outlined on the specifics of the in-app js of the code below in this <a href="https://github.com/phonegap/phonegap-plugins/tree/master/iPhone/InAppPurchaseManager">LINK</a>, but my example code below will get you up and running. 
I AM NOT including all the css and js for the example code below because this is a personal project, but you should be able to take the guts of what you see here and make it work for you. Maybe in the near future I will post a full working example.</p>

<p>Note the js is closest to top so it will load your products first, and unlock products if already purchased.</p>

<h2>About Itunes Connect</h2>

<p>Make sure your in-app products are in itunes connect and make sure the message says, waiting for screenshot. That worked for me best and right away, no delay.</p>

<p>Also make sure you have signed all the tax documents and filled out your bank info etc for the iOS Paid Applications. This is key to selling :) You can find this under your main window when you login to Itunes Connect. Then click on the link that says, Contracts, Tax, and Banking.</p>

<p><img src="http://slickremix.com/gitub-InAppPurchaseManager-EXAMPLE-images/contract-link.png" alt="My image"></p>

<h3>DO NOT USE SIMULATOR FOR IN-APP TESTING, USE YOUR DEVICE TO TEST.</h3>

<h2>Additional Project Images</h2>

<p>Hopefully these will help some people out too. I am using Xcode 4.5.1 </p>

<p>This is a look at the cordova.plist
<img src="http://slickremix.com/gitub-InAppPurchaseManager-EXAMPLE-images/overview%20of%20cordova%20plist.png" alt="My image"></p>

<p>This is a look at the bundle identifier area that needs to match your App ID you should have created in Itunes Connect.
<img src="http://slickremix.com/gitub-InAppPurchaseManager-EXAMPLE-images/bundle%20identifier.png" alt="My image"></p>

<h2>In this project I used</h2>

<ol>
<li>InAppPurchaseManager</li>
<li>applicationPreferences (btw. you don't have to use this to make the inAppPurchaseManager function)</li>
<li>Cordova 2.0.0</li>
<li>Xcode 4.5.1</li>
</ol><h3>NOTE</h3>

<p>Also See Project Images below this code depicting Cordova.plist settings and bundle identifier settings, just in case you have overlooked anything. It's always better to see what a real project looks like than hearing about it, especially if it's your first one. </p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;

&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
&lt;meta name = "format-detection" content = "telephone=no"/&gt;
&lt;meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/&gt;
&lt;meta name="apple-mobile-web-app-capable" content="yes"/&gt;
&lt;meta name="apple-mobile-web-app-status-bar-style" content="black"/&gt;
&lt;title&gt;FORTHEKREW MAGAZINE&lt;/title&gt;
&lt;script src="js/cordova-2.0.0.js" type="text/javascript" &gt;&lt;/script&gt;
&lt;script src="js/InAppPurchaseManager.js" type="text/javascript" &gt;&lt;/script&gt;
&lt;script src="js/applicationPreferences.js" type="text/javascript" &gt;&lt;/script&gt;
&lt;script src="js/jquery-1.7.1.min.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script type="text/javascript" charset="utf-8"&gt;
    document.addEventListener('deviceready', function() {

    // Product ftk50                      
    window.plugins.inAppPurchaseManager.requestProductData("FTKMAG50", function(productId, title, description, price) {
                                                           console.log("productId: " + productId + " title: " + title + " description: " + description + " price: " + price);
         // verify product has already been purchases and unlock                                                   
         var productIds1 = ["FTKMAG50"];

         for (var i = 0; i &lt; productIds1.length; i++) {
         var productId = productIds1[i];
         window.plugins.applicationPreferences.get(productId, function(result) {
                                                   if (result) {
                                                   unlockProduct(productId);
                                                   console.log("restart unlocked: " + productId);
                                                     }
                                                   });
                 }
            }, 

         function(id) {
         console.log("Invalid product id: " + id);
    });


    // Product ftk49
    window.plugins.inAppPurchaseManager.requestProductData("FTKMAG49", function(productId, title, description, price) {
                                                           console.log("productId: " + productId + " title: " + title + " description: " + description + " price: " + price);
         // verify product has already been purchases and unlock                                                   
         var productIds1 = ["FTKMAG49"];

         for (var i = 0; i &lt; productIds1.length; i++) {
         var productId = productIds1[i];
         window.plugins.applicationPreferences.get(productId, function(result) {
                                                   if (result) {
                                                   unlockProduct(productId);
                                                   console.log("restart unlocked: " + productId);
                                                     }
                                                   });
                }
            }, 

         function(id) {
         console.log("Invalid product id: " + id);

    });


    // unlock product 
    function unlockProduct(productId) {
            var   a = "FTKMAG50",
                  b = "FTKMAG49";

            if(productId == a) {
                  $('.ftk50 .button-background div:nth-child(1n)').hide();
                  $('.ftk50 .button-background').addClass('highlight-color');
                  $('.ftk50 .button-background div:nth-child(2n)').fadeIn();
            }

            if(productId == b) {
                  $('.ftk49 .button-background div:nth-child(1n)').hide();
                  $('.ftk49 .button-background').addClass('highlight-color');
                  $('.ftk49 .button-background div:nth-child(2n)').fadeIn();
            }

        console.log('unlocked: ' + productId);
    }

    // unlock product                       
    window.plugins.inAppPurchaseManager.onPurchased = function(transactionIdentifier, productId, transactionReceipt) {
    console.log('purchased: ' + productId);

        window.plugins.applicationPreferences.set(productId, true, function() {
                                                  unlockProduct(productId);
                                                  });
    }


    // restore products 
    window.plugins.inAppPurchaseManager.onRestored = function(transactionIdentifier, productId, originalTransactionReceipt) {
        window.plugins.applicationPreferences.set(productId, true, function() {
                                                  unlockProduct(productId);
                                                    //  $('#popupPadded h2').removeClass('loader');
                                                      $('.restore-purchases-btn').hide();
                                                      $('.restore-purchases-btn-complete').fadeIn();

                                                        $('.purchase-message').hide();
                                                        $('.purchase-message-complete').show();

                                                  });
        console.log('restored: ' + productId);
    }

    // onFailed 
    window.plugins.inAppPurchaseManager.onFailed = function(errno, errtext) {
        console.log('failed: ' + errtext);

    }


}); // on device ready close


    // process the confirmation dialog result
    function onConfirm(button) {
        if(button == 2) {
            window.plugins.inAppPurchaseManager.restoreCompletedTransactions();
           // $('#popupPadded h2').addClass('loader');
        }
    }

    // Show a custom confirmation dialog
    function showConfirm() {
        navigator.notification.confirm(
                                           'Restore All Purchases?',  // message
                                            onConfirm,               // callback to invoke with index of button pressed
                                           'FTK Magazine',          // title
                                           'Cancel, OK'            // buttonLabels
                                       );

    }
&lt;/script&gt;
&lt;link href="css/jquery.mobile-1.2.0.css" media="screen" rel="stylesheet" type="text/css" /&gt;
&lt;link href="css/bartender.css" type="text/css" rel="stylesheet" /&gt;
&lt;link href="css/jquery-mobile.css" type="text/css" rel="stylesheet" /&gt;
&lt;link href="css/jquery.mobile.iscrollview.css" media="screen" rel="stylesheet" type="text/css" /&gt;

&lt;script src="js/jquery.mobile-1.2.0.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script src="js/iscroll.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script src="js/jquery.mobile.iscrollview.js" type="text/javascript"&gt;&lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;

&lt;div data-role="page" data-theme="a" id="page1"&gt;
&lt;div data-role="header" data-position="fixed" data-tap-toggle="false" class="animated-icons"&gt; &lt;a href="#" data-icon="home" id="home" data-iconpos="notext"&gt;Home&lt;/a&gt; &lt;a data-icon="gear" data-iconpos="notext"  href="#popupPadded" data-rel="popup" data-transition="fade" data-position-to="window" id="settings-home"&gt;Settings&lt;/a&gt;
    &lt;h1&gt;FORTHEKREW LIBRARY&lt;/h1&gt;
 &lt;/div&gt;
 &lt;!-- /header --&gt;

 &lt;div id="results"&gt;&lt;/div&gt;

 &lt;div data-role="content" data-iscroll=""&gt;
   &lt;ul data-inset="true" data-role="listview" data-theme="a" id="ftk-list"&gt;
    &lt;li&gt; &lt;a href="#"&gt;&lt;img src="img/50-icon2.jpg" class="my-test" /&gt;
        &lt;h3&gt;Issue#50&lt;/h3&gt;
        &lt;p&gt;September-October 2012&lt;br/&gt;
        Cover: Gary Bolos&lt;/p&gt;
        &lt;div class="description-long"&gt;Trick tip with Dan Plunkett. Interviews with Gary Bolos and John DiLorenzo. Scene check out Naples, Florida. Coming up with Caleb Des Cognets. Shoplifter with Relief Skate Supply.&lt;/div&gt;
      &lt;h4&gt;$1.99&lt;/h4&gt;
       &lt;div class="ftk-btn-wrap ftk50"&gt;
       &lt;div class="glow-hover-effect"&gt;&lt;/div&gt;
        &lt;div class="button-background"&gt;
            &lt;input type="button" value="Buy Now" data-ajax="false" id="ftk50" /&gt;
            &lt;input type="button" onClick="window.open('ftk50.html','_self');" value="View Magazine" data-ajax="false" id="ftk50-view" /&gt;
          &lt;/div&gt;
       &lt;/div&gt;
    &lt;/a&gt; &lt;a href="#" data-theme="a"&gt;&lt;/a&gt; &lt;/li&gt;
  &lt;li&gt;&lt;a href="#"&gt;&lt;img src="img/49-icon.png" /&gt;
    &lt;h3&gt;Issue#49&lt;/h3&gt;
    &lt;p&gt;July-August 2012&lt;br/&gt;
    Cover: Josh Weathers&lt;/p&gt;
    &lt;div class="description-long"&gt;Trick tip with Andrew Edge.  Interviews with Nate Greenwood and Josh Weathers. Scene check out Jacksonville, Florida. Hemming Plaza. Go Skateboarding Day. Coming ups, Chris Lesh &amp; more.&lt;/div&gt;
    &lt;h4&gt;$1.99&lt;/h4&gt;
    &lt;div class="ftk-btn-wrap ftk49"&gt;
    &lt;div class="glow-hover-effect"&gt;&lt;/div&gt;
    &lt;div class="button-background"&gt;
        &lt;input type="button" value="Buy Now" data-ajax="false" id="ftk49" /&gt;
        &lt;input type="button" onClick="window.open('ftk49.html','_self');" value="View Magazine" data-ajax="false" id="ftk49-view" /&gt;
      &lt;/div&gt;
  &lt;/div&gt;
    &lt;/a&gt; &lt;a href="#" data-theme="a"&gt;&lt;/a&gt; &lt;/li&gt;
 &lt;/ul&gt;
&lt;/div&gt;
&lt;!--/content--&gt;

&lt;div data-role="footer" data-id="mainFooter" data-position="fixed" data-tap-toggle="false"&gt;
  &lt;div data-role="navbar" data-grid="b" id="slick-footer"&gt;
    &lt;ul class="apple-navbar-ui comboSprite" id="footer-animate"&gt;
      &lt;li class"settings-page"&gt;&lt;a href="#popupPadded" data-rel="popup" data-transition="fade" data-position-to="window" data-icon="features" id="more-page"&gt;Settings&lt;/a&gt;&lt;/li&gt;
      &lt;li class"library-page-active"&gt;&lt;a data-icon="brands" class="ui-btn-active ui-state-persist ui-btn-active-stay"&gt;Library&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href="https://www.facebook.com/ftkmagazine" target="_blank" data-icon="contact"&gt;Facebook&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;



&lt;div id="popupPadded" data-role="popup" data-theme="a" data-overlay-theme="a"&gt;
    &lt;a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right close-btn"&gt;Close&lt;/a&gt;

    &lt;h2&gt;Settings&lt;/h2&gt;
    &lt;p class="purchase-message"&gt;If you have previously purchased magazines that are not in your library, and would like to restore them please click below.&lt;/p&gt;
    &lt;p class="purchase-message-complete"&gt;Your download(s) are now complete. Thanks for keeping up with our mag. More good things to come, stay tuned!&lt;/p&gt;
    &lt;div id="restore-purchases"&gt; &lt;a href="#" data-role="button" onclick="showConfirm(); return false;" id="restore-purchases-btn" class="restore-purchases-btn"&gt;Restore All Purchases&lt;/a&gt; &lt;a href="#page1" data-role="button" class="restore-purchases-btn-complete ui-btn-active ui-state-persist" style="display:none" data-transition="fade"&gt;Restore Complete&lt;/a&gt;

    &lt;/div&gt;
&lt;/div&gt;&lt;!--#popupPadded--&gt;



&lt;/div&gt;
&lt;!--/page--&gt;


&lt;script type="text/javascript" charset="utf-8"&gt;
$(document).ready(function(){

              $('.close-btn').click(function () {
                        $('.library-page-active a').addClass('ui-btn-active');
                                                })

    $('#ftk-list img').fadeIn(1000);

     setTimeout (function(){ $('.apple-navbar-ui li').fadeIn(500); },1000);

$('#ftk-list li a input').buttonMarkup({ corners: true, theme: "a" });

$('#ftk50').bind('touchstart', function() {
                 $('.ftk50 .glow-hover-effect').fadeIn();          
                 window.plugins.inAppPurchaseManager.makePurchase('FTKMAG50', 1); //here we make our purchase when button is tapped.
                 });
$('#ftk50').bind('touchend', function() {
                 $('.ftk50 .glow-hover-effect').fadeOut();
                 });
$('#ftk50-view').bind('touchstart', function() {
                 $('.ftk50 .glow-hover-effect').fadeIn();  
                 });
$('#ftk50-view').bind('touchend', function() {
                 $('.ftk50 .glow-hover-effect').fadeOut();
                 });
$('#ftk49').bind('touchstart', function() {
                 $('.ftk49 .glow-hover-effect').fadeIn();         
                 window.plugins.inAppPurchaseManager.makePurchase('FTKMAG49', 1); //here we make our purchase when button is tapped.
                 });
$('#ftk49').bind('touchend', function() {
                 $('.ftk49 .glow-hover-effect').fadeOut();
                 });

$('#ftk49-view').bind('touchstart', function() {
                 $('.ftk49 .glow-hover-effect').fadeIn();
                 });
$('#ftk49-view').bind('touchend', function() {
                 $('.ftk49 .glow-hover-effect').fadeOut();
                 });

});
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">InAppPurchaseManager Example maintained by <a href="https://github.com/usmart">usmart</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-25554594-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
