{"google":"UA-25554594-1","name":"InAppPurchaseManager Example","body":"#iOS InAppPurchaseManager EXAMPLE OCTOBER 2012\r\n\r\nI have had so many issues getting the [OG] (https://github.com/phonegap/phonegap-plugins/tree/master/iOS/InAppPurchaseManager) version to work, I had to share this so others can stop struggling and get to work! Here is a modifed working version of this plugin, which also explains how to use the ApplicationPreferences Phonegap plugin to unlock products in your app, and the ever dreaded, \"how do I make a restore purchases call\" and then unlock contents. I have also included a few project screen shots that will hopefully help first timers out.\r\n\r\nProps first go to the main deveoper who has made this possible, [Matt Kane] (https://github.com/phonegap/phonegap-plugins/tree/master/iOS/InAppPurchaseManager). And the countless other people on the web posting examples and helping out with questions.\r\n\r\nIF ANYONE wants to help clean this up and bring it more up to speed than this, I am all for it!\r\n\r\n## Adding the Plugin to your project\r\n\r\nCopy the NEWLY REVISED .h and .m files to the Plugins directory in your project. Copy the NEWLY REVISED .js file to your www directory and reference it from your html file(s). Finally, add StoreKit.framework to your Xcode project if you haven't already. \r\n###Adding StoreKit to you project.\r\n1.  Click on your project\r\n2.  then your project target\r\n3.  then Build Phases\r\n4.  then open the Link Binary with Libraries. \r\n5.  Now drag the storeKit Framework over to your Project name area, as depicted in photo.\r\n\r\n![My image](http://slickremix.com/gitub-InAppPurchaseManager-EXAMPLE-images/storekit.png)\r\n\r\n###ALSO\r\nIf you want to UNLOCK PRODUCTS as I have done below you will need to use the [ApplicationPreferences Plugin] (https://github.com/phonegap/phonegap-plugins/tree/master/iPhone/ApplicationPreferences). Everything works out of the box here too. \r\nYou do not really need to worry about the examples displayed there for the example code below, just add the files to your plugin folder as instructed on that page.\r\n\r\nI am using cordova 2.0. If you are using 2.1 all instances of JSONString in InAppPurchaseManager.m must be replaced with cdvjk_JSONString\r\n\r\n## MOST IMPORTANT\r\nDont forget to add the plugins names to your .plist in your project name folder.\r\n* For example the in-app plugin needs to be...take note the first on has a lower case i, this is not a typo!\r\n* inAppPurchaseManager (string name is) InAppPurchaseManager\r\n\r\nThen if you are using going to implement the ApplicationPreferences Plugin don't forget to add that to .plist too.\r\n* This plugins names both start with a lower case a.\r\n* applicationPreferences (string name is) applicationPreferences\r\n\r\n\r\n## Using the plugin\r\nYou can read the details outlined on the specifics of the in-app js of the code below in this [LINK] (https://github.com/phonegap/phonegap-plugins/tree/master/iPhone/InAppPurchaseManager), but my example code below will get you up and running. \r\nI AM NOT including all the css and js for the example code below because this is a personal project, but you should be able to take the guts of what you see here and make it work for you. Maybe in the near future I will post a full working example.\r\n\r\nNote the js is closest to top so it will load your products first, and unlock products if already purchased.\r\n\r\n## About Itunes Connect\r\nMake sure your in-app products are in itunes connect and make sure the message says, waiting for screenshot. That worked for me best and right away, no delay.\r\n\r\nAlso make sure you have signed all the tax documents and filled out your bank info etc for the iOS Paid Applications. This is key to selling :) You can find this under your main window when you login to Itunes Connect. Then click on the link that says, Contracts, Tax, and Banking.\r\n\r\n![My image](http://slickremix.com/gitub-InAppPurchaseManager-EXAMPLE-images/contract-link.png)\r\n \r\n\r\n### DO NOT USE SIMULATOR FOR IN-APP TESTING, USE YOUR DEVICE TO TEST. \r\n\r\n\r\n## Additional Project Images ##\r\n\r\nHopefully these will help some people out too. I am using Xcode 4.5.1 \r\n\r\n\r\nThis is a look at the cordova.plist\r\n![My image](http://slickremix.com/gitub-InAppPurchaseManager-EXAMPLE-images/overview%20of%20cordova%20plist.png)\r\n\r\n\r\nThis is a look at the bundle identifier area that needs to match your App ID you should have created in Itunes Connect.\r\n![My image](http://slickremix.com/gitub-InAppPurchaseManager-EXAMPLE-images/bundle%20identifier.png)\r\n\r\n\r\nIn this project I used\r\n-------------------------\r\n\r\n1. InAppPurchaseManager\r\n2. applicationPreferences (btw. you don't have to use this to make the inAppPurchaseManager function)\r\n3. Cordova 2.0.0\r\n4. Xcode 4.5.1\r\n\r\n### NOTE\r\nAlso See Project Images below this code depicting Cordova.plist settings and bundle identifier settings, just in case you have overlooked anything. It's always better to see what a real project looks like than hearing about it, especially if it's your first one. \r\n\r\n\r\n\t<!DOCTYPE html>\r\n\t<html>\r\n\t<head>\r\n\r\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\r\n\t<meta name = \"format-detection\" content = \"telephone=no\"/>\r\n\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no\"/>\r\n\t<meta name=\"apple-mobile-web-app-capable\" content=\"yes\"/>\r\n\t<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\"/>\r\n\t<title>FORTHEKREW MAGAZINE</title>\r\n\t<script src=\"js/cordova-2.0.0.js\" type=\"text/javascript\" ></script>\r\n\t<script src=\"js/InAppPurchaseManager.js\" type=\"text/javascript\" ></script>\r\n\t<script src=\"js/applicationPreferences.js\" type=\"text/javascript\" ></script>\r\n\t<script src=\"js/jquery-1.7.1.min.js\" type=\"text/javascript\"></script>\r\n\t<script type=\"text/javascript\" charset=\"utf-8\">\r\n    \tdocument.addEventListener('deviceready', function() {\r\n\t\t\r\n\t\t// Product ftk50                      \r\n\t\twindow.plugins.inAppPurchaseManager.requestProductData(\"FTKMAG50\", function(productId, title, description, price) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   console.log(\"productId: \" + productId + \" title: \" + title + \" description: \" + description + \" price: \" + price);\r\n\t\t\t // verify product has already been purchases and unlock \t\t\t\t\t\t\t\t\t\t\t\t   \r\n\t\t\t var productIds1 = [\"FTKMAG50\"];\r\n\t\t\t \r\n\t\t\t for (var i = 0; i < productIds1.length; i++) {\r\n\t\t\t var productId = productIds1[i];\r\n\t\t\t window.plugins.applicationPreferences.get(productId, function(result) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   if (result) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   unlockProduct(productId);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   console.log(\"restart unlocked: \" + productId);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   });\r\n\t\t\t\t\t }\r\n\t\t\t\t}, \r\n\t\t\t \r\n\t\t\t function(id) {\r\n\t\t\t console.log(\"Invalid product id: \" + id);\r\n\t\t});\r\n\t\t\t\r\n\t\t\r\n\t\t// Product ftk49\r\n\t\twindow.plugins.inAppPurchaseManager.requestProductData(\"FTKMAG49\", function(productId, title, description, price) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   console.log(\"productId: \" + productId + \" title: \" + title + \" description: \" + description + \" price: \" + price);\r\n\t\t\t // verify product has already been purchases and unlock \t\t\t\t\t\t\t\t\t\t\t\t   \r\n\t\t\t var productIds1 = [\"FTKMAG49\"];\r\n\t\t\t \r\n\t\t\t for (var i = 0; i < productIds1.length; i++) {\r\n\t\t\t var productId = productIds1[i];\r\n\t\t\t window.plugins.applicationPreferences.get(productId, function(result) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   if (result) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   unlockProduct(productId);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   console.log(\"restart unlocked: \" + productId);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   });\r\n\t\t\t\t\t}\r\n\t\t\t\t}, \r\n\t\t\t\t\r\n\t\t\t function(id) {\r\n\t\t\t console.log(\"Invalid product id: \" + id);\r\n\t\t\t \r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\t// unlock product \r\n\t\tfunction unlockProduct(productId) {\r\n\t\t\t\tvar   a = \"FTKMAG50\",\r\n\t\t\t\t\t  b = \"FTKMAG49\";\r\n\t\t\t\t\r\n\t\t\t\tif(productId == a) {\r\n\t\t\t\t\t  $('.ftk50 .button-background div:nth-child(1n)').hide();\r\n\t\t\t\t\t  $('.ftk50 .button-background').addClass('highlight-color');\r\n\t\t\t\t\t  $('.ftk50 .button-background div:nth-child(2n)').fadeIn();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(productId == b) {\r\n\t\t\t\t\t  $('.ftk49 .button-background div:nth-child(1n)').hide();\r\n\t\t\t\t\t  $('.ftk49 .button-background').addClass('highlight-color');\r\n\t\t\t\t\t  $('.ftk49 .button-background div:nth-child(2n)').fadeIn();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\tconsole.log('unlocked: ' + productId);\r\n\t\t}\r\n\t\t\t\t\t\t\t  \r\n\t\t// unlock product                       \r\n\t\twindow.plugins.inAppPurchaseManager.onPurchased = function(transactionIdentifier, productId, transactionReceipt) {\r\n\t\tconsole.log('purchased: ' + productId);\r\n\t\t\r\n\t\t\twindow.plugins.applicationPreferences.set(productId, true, function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t  unlockProduct(productId);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t  });\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t// restore products\t\r\n\t\twindow.plugins.inAppPurchaseManager.onRestored = function(transactionIdentifier, productId, originalTransactionReceipt) {\r\n\t\t\twindow.plugins.applicationPreferences.set(productId, true, function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t  unlockProduct(productId);\r\n                                                        //  $('#popupPadded h2').removeClass('loader');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  $('.restore-purchases-btn').hide();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  $('.restore-purchases-btn-complete').fadeIn();\r\n                                                      \r\n                                                            $('.purchase-message').hide();\r\n                                                            $('.purchase-message-complete').show();\r\n                                                      \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t  });\r\n\t\t\tconsole.log('restored: ' + productId);\r\n\t\t}\r\n\t\t\r\n\t\t// onFailed\t\r\n\t\twindow.plugins.inAppPurchaseManager.onFailed = function(errno, errtext) {\r\n\t\t\tconsole.log('failed: ' + errtext);\r\n                          \r\n\t\t}\r\n\t\t\t\t\t\t\t  \r\n\t\t\t\t\t\t\t  \r\n\t}); // on device ready close\r\n\t\r\n\t\r\n\t\t// process the confirmation dialog result\r\n\t\tfunction onConfirm(button) {\r\n\t\t\tif(button == 2) {\r\n\t\t\t\twindow.plugins.inAppPurchaseManager.restoreCompletedTransactions();\r\n               // $('#popupPadded h2').addClass('loader');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Show a custom confirmation dialog\r\n\t\tfunction showConfirm() {\r\n\t\t\tnavigator.notification.confirm(\r\n\t\t\t\t\t\t\t\t\t\t\t   'Restore All Purchases?',  // message\r\n\t\t\t\t\t\t\t\t\t\t\t\tonConfirm,               // callback to invoke with index of button pressed\r\n\t\t\t\t\t\t\t\t\t\t\t   'FTK Magazine',          // title\r\n\t\t\t\t\t\t\t\t\t\t\t   'Cancel, OK'            // buttonLabels\r\n\t\t\t\t\t\t\t\t\t\t   );\r\n            \r\n\t\t}\r\n\t</script>\r\n\t<link href=\"css/jquery.mobile-1.2.0.css\" media=\"screen\" rel=\"stylesheet\" type=\"text/css\" />\r\n\t<link href=\"css/bartender.css\" type=\"text/css\" rel=\"stylesheet\" />\r\n\t<link href=\"css/jquery-mobile.css\" type=\"text/css\" rel=\"stylesheet\" />\r\n\t<link href=\"css/jquery.mobile.iscrollview.css\" media=\"screen\" rel=\"stylesheet\" type=\"text/css\" />\r\n\r\n\t<script src=\"js/jquery.mobile-1.2.0.js\" type=\"text/javascript\"></script>\r\n\t<script src=\"js/iscroll.js\" type=\"text/javascript\"></script>\r\n\t<script src=\"js/jquery.mobile.iscrollview.js\" type=\"text/javascript\"></script>\r\n    \r\n\t</head>\r\n\t<body>\r\n\r\n\t<div data-role=\"page\" data-theme=\"a\" id=\"page1\">\r\n  \t<div data-role=\"header\" data-position=\"fixed\" data-tap-toggle=\"false\" class=\"animated-icons\"> <a href=\"#\" data-icon=\"home\" id=\"home\" data-iconpos=\"notext\">Home</a> <a data-icon=\"gear\" data-iconpos=\"notext\"  href=\"#popupPadded\" data-rel=\"popup\" data-transition=\"fade\" data-position-to=\"window\" id=\"settings-home\">Settings</a>\r\n    \t<h1>FORTHEKREW LIBRARY</h1>\r\n \t </div>\r\n \t <!-- /header -->\r\n    \r\n \t <div id=\"results\"></div>\r\n    \r\n \t <div data-role=\"content\" data-iscroll=\"\">\r\n \t   <ul data-inset=\"true\" data-role=\"listview\" data-theme=\"a\" id=\"ftk-list\">\r\n  \t    <li> <a href=\"#\"><img src=\"img/50-icon2.jpg\" class=\"my-test\" />\r\n    \t    <h3>Issue#50</h3>\r\n        \t<p>September-October 2012<br/>\r\n        \tCover: Gary Bolos</p>\r\n        \t<div class=\"description-long\">Trick tip with Dan Plunkett. Interviews with Gary Bolos and John DiLorenzo. Scene check out Naples, Florida. Coming up with Caleb Des Cognets. Shoplifter with Relief Skate Supply.</div>\r\n      \t  <h4>$1.99</h4>\r\n     \t   <div class=\"ftk-btn-wrap ftk50\">\r\n     \t   <div class=\"glow-hover-effect\"></div>\r\n    \t    <div class=\"button-background\">\r\n        \t    <input type=\"button\" value=\"Buy Now\" data-ajax=\"false\" id=\"ftk50\" />\r\n     \t        <input type=\"button\" onClick=\"window.open('ftk50.html','_self');\" value=\"View Magazine\" data-ajax=\"false\" id=\"ftk50-view\" />\r\n    \t      </div>\r\n   \t\t   </div>\r\n        </a> <a href=\"#\" data-theme=\"a\"></a> </li>\r\n      <li><a href=\"#\"><img src=\"img/49-icon.png\" />\r\n        <h3>Issue#49</h3>\r\n        <p>July-August 2012<br/>\r\n        Cover: Josh Weathers</p>\r\n        <div class=\"description-long\">Trick tip with Andrew Edge.  Interviews with Nate Greenwood and Josh Weathers. Scene check out Jacksonville, Florida. Hemming Plaza. Go Skateboarding Day. Coming ups, Chris Lesh & more.</div>\r\n        <h4>$1.99</h4>\r\n        <div class=\"ftk-btn-wrap ftk49\">\r\n        <div class=\"glow-hover-effect\"></div>\r\n        <div class=\"button-background\">\r\n            <input type=\"button\" value=\"Buy Now\" data-ajax=\"false\" id=\"ftk49\" />\r\n            <input type=\"button\" onClick=\"window.open('ftk49.html','_self');\" value=\"View Magazine\" data-ajax=\"false\" id=\"ftk49-view\" />\r\n          </div>\r\n      </div>\r\n        </a> <a href=\"#\" data-theme=\"a\"></a> </li>\r\n     </ul>\r\n    </div>\r\n    <!--/content-->\r\n  \r\n    <div data-role=\"footer\" data-id=\"mainFooter\" data-position=\"fixed\" data-tap-toggle=\"false\">\r\n      <div data-role=\"navbar\" data-grid=\"b\" id=\"slick-footer\">\r\n        <ul class=\"apple-navbar-ui comboSprite\" id=\"footer-animate\">\r\n          <li class\"settings-page\"><a href=\"#popupPadded\" data-rel=\"popup\" data-transition=\"fade\" data-position-to=\"window\" data-icon=\"features\" id=\"more-page\">Settings</a></li>\r\n          <li class\"library-page-active\"><a data-icon=\"brands\" class=\"ui-btn-active ui-state-persist ui-btn-active-stay\">Library</a></li>\r\n          <li><a href=\"https://www.facebook.com/ftkmagazine\" target=\"_blank\" data-icon=\"contact\">Facebook</a></li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n\r\n    \r\n\r\n    <div id=\"popupPadded\" data-role=\"popup\" data-theme=\"a\" data-overlay-theme=\"a\">\r\n        <a href=\"#\" data-rel=\"back\" data-role=\"button\" data-theme=\"a\" data-icon=\"delete\" data-iconpos=\"notext\" class=\"ui-btn-right close-btn\">Close</a>\r\n     \r\n        <h2>Settings</h2>\r\n        <p class=\"purchase-message\">If you have previously purchased magazines that are not in your library, and would like to restore them please click below.</p>\r\n        <p class=\"purchase-message-complete\">Your download(s) are now complete. Thanks for keeping up with our mag. More good things to come, stay tuned!</p>\r\n        <div id=\"restore-purchases\"> <a href=\"#\" data-role=\"button\" onclick=\"showConfirm(); return false;\" id=\"restore-purchases-btn\" class=\"restore-purchases-btn\">Restore All Purchases</a> <a href=\"#page1\" data-role=\"button\" class=\"restore-purchases-btn-complete ui-btn-active ui-state-persist\" style=\"display:none\" data-transition=\"fade\">Restore Complete</a>\r\n        \r\n        </div>\r\n    </div><!--#popupPadded-->\r\n    \r\n    \r\n    \r\n\t</div>\r\n\t<!--/page-->\r\n\r\n\r\n\t<script type=\"text/javascript\" charset=\"utf-8\">\r\n\t$(document).ready(function(){\r\n             \r\n                  $('.close-btn').click(function () {\r\n                            $('.library-page-active a').addClass('ui-btn-active');\r\n                                                    })\r\n                  \r\n\t\t$('#ftk-list img').fadeIn(1000);\r\n\r\n\t\t setTimeout (function(){ $('.apple-navbar-ui li').fadeIn(500); },1000);\r\n\t\r\n\t$('#ftk-list li a input').buttonMarkup({ corners: true, theme: \"a\" });\r\n\t\t\t\t\t\t\t\t\t\r\n\t$('#ftk50').bind('touchstart', function() {\r\n\t\t\t\t\t $('.ftk50 .glow-hover-effect').fadeIn();          \r\n\t\t\t\t\t window.plugins.inAppPurchaseManager.makePurchase('FTKMAG50', 1); //here we make our purchase when button is tapped.\r\n\t\t\t\t\t });\r\n\t$('#ftk50').bind('touchend', function() {\r\n\t\t\t\t\t $('.ftk50 .glow-hover-effect').fadeOut();\r\n\t\t\t\t\t });\r\n\t$('#ftk50-view').bind('touchstart', function() {\r\n\t\t\t\t     $('.ftk50 .glow-hover-effect').fadeIn();  \r\n\t\t\t\t     });\r\n\t$('#ftk50-view').bind('touchend', function() {\r\n\t\t\t\t\t $('.ftk50 .glow-hover-effect').fadeOut();\r\n\t\t\t\t     });\r\n\t$('#ftk49').bind('touchstart', function() {\r\n\t\t\t\t\t $('.ftk49 .glow-hover-effect').fadeIn();         \r\n\t\t\t\t\t window.plugins.inAppPurchaseManager.makePurchase('FTKMAG49', 1); //here we make our purchase when button is tapped.\r\n\t\t\t\t\t });\r\n\t$('#ftk49').bind('touchend', function() {\r\n\t\t\t\t\t $('.ftk49 .glow-hover-effect').fadeOut();\r\n\t\t\t\t\t });\r\n\r\n\t$('#ftk49-view').bind('touchstart', function() {\r\n\t\t\t\t\t $('.ftk49 .glow-hover-effect').fadeIn();\r\n\t\t\t\t\t });\r\n\t$('#ftk49-view').bind('touchend', function() {\r\n\t\t\t\t\t $('.ftk49 .glow-hover-effect').fadeOut();\r\n\t\t\t\t\t });\r\n\t                       \r\n\t});\r\n\t</script>\r\n    \r\n\t</body>\r\n\t</html>","note":"Don't delete this file! It's used internally to help with page regeneration.","tagline":"I have had so many issues getting the OG version to work, I had to share this so others can stop struggling and get to work!"}